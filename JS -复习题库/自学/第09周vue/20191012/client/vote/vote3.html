<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
	<title>珠峰培训 - 微信：18310612838</title>
	<!-- IMPORT CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<style>
		.container {
			box-sizing: border-box;
			margin: 20px auto;
			padding: 10px;
			width: 400px;
			border: 1px solid #AAA;
		}

		.container h3 {
			font-size: 16px;
			font-weight: bold;
			line-height: 40px;
			border-bottom: 1px dashed #AAA;
		}
	</style>
</head>

<body>
	<div id="app">
		<vote-plugin v-for='item in votes' :title='item.title'></vote-plugin>
	</div>
	<!-- TEMPLATE -->
	<template id='VotePluginTemplate'>
		<div class="container">
			<h3>
				<span v-text='title'></span>
				&nbsp;&nbsp;
				参与人数：<span v-text='nums.supNum+nums.oppNum'></span>
			</h3>
			<vote-content></vote-content>
			<vote-button></vote-button>
		</div>
	</template>
	<!-- IMPORT JS -->
	<script src="js/vue.js"></script>
	<script>
		const VoteContent = {
			template: `<div class="content">
				<p>支持人数：<span v-text='nums.supNum'></span></p>
				<p>反对人数：<span v-text='nums.oppNum'></span></p>
				<p>支持率：<span v-text='ratio'></span></p>
			</div>`,
			inject: ['nums'],
			computed: {
				ratio() {
					let total = this.nums.supNum + this.nums.oppNum;
					return total === 0 ? '0%' : (this.nums.supNum / total * 100).toFixed(2) + '%';
				}
			}
		};

		const VoteButton = {
			template: `<div class="footer">
				<button type="button" 
					class="btn btn-primary" 
					@click="handle('support')
				">支持</button>
				<button type="button" 
					class="btn btn-danger" 
					@click="handle('oppose')
				">反对</button>
			</div>`,
			//=>和PROPS一样都会把注册的信息挂载到实例上
			inject: ['change'],
			methods: {
				handle(type) {
					this.change(type);
				}
			}
		};

		Vue.component('VotePlugin', {
			template: '#VotePluginTemplate',
			//=>这些数据存储在this._provided：可以是对象也可以是闭包的方式，闭包方式的好处是“它会在实例上的信息都挂载完成后再处理”
			provide() {
				return {
					nums: this.nums,
					change: this.change
				}
			},
			props: ['title'],
			components: {
				VoteContent,
				VoteButton
			},
			data() {
				return {
					nums: {
						supNum: 0,
						oppNum: 0
					}
				}
			},
			methods: {
				change(type) {
					type === 'support' ? this.nums.supNum++ : this.nums.oppNum++;
				}
			}
		});

		//=>把内容渲染到视图中
		let vm = new Vue({
			data: {
				votes: [{
					id: 1,
					title: '朱春亮跑得快！嗯！'
				}, {
					id: 2,
					title: '吴振宇该去下一期了！啊？'
				}]
			}
		});
		vm.$mount('#app');
	</script>
</body>

</html>